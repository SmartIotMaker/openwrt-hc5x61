<%
local ver = require "luci.version"
%>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="format-detection" content="telephone=no" />
<title>HiWiFi 路由器</title>
<link rel="stylesheet" href="<%=resource%>/web/css/style.css?v=<%=ver.svnRevNum%>" type="text/css"/>
<script type="text/javascript" src="<%=resource%>/web/js/jquery-1.8.1.min.js?v=<%=ver.svnRevNum%>"></script>
<script type="text/javascript" src="<%=resource%>/web/js/artDialog/jquery.artDialog.js?skin=blueskin"></script>
<script type="text/javascript" src="<%=resource%>/web/js/artDialog/plugins/iframeTools.source.js?v=<%=ver.svnRevNum%>"></script>
<script type="text/javascript" src="<%=resource%>/validators.min.js?v=<%=ver.svnRevNum%>"></script>
</head>

<style type="text/css">
    table.zone td.tor{
        text-align: right;
        width:120px;
        line-height:14px;
    }
</style>
<body>
<div class="title">
    <h2>高级设置<i>设置路由器安全 , 及其他高级设置</i></h2>
</div>
<div class="menu">
    <% include("admin_web/menu/adv_menu") %>
</div>

<div class="box setup_box">
    <% if step == 1 then %>
	<form method="post" action="<%=REQUEST_URI%>" enctype="multipart/form-data">
        <div class="memu row">
            <p>
            <label>
            <%:选择升级包:%>
            </label>
            <br />
            <br />
            </p>
            <input type="hidden" name="step" value="2" />
            <input type="file" size="30" name="image" />
            <input class="btn" type="submit" value="<%:上传%>" />
        </div>
	</form>
<% elseif step == 2 then %>
    <div class="memu row">
		<% if image_invalid then %>
        <p>
        <label style="color:red;"><%:非法升级包%></label>
        </p>
		<form style="display:inline">
			<input type="hidden" name="step" value="1" />
			<input class="btn" type="submit" value="重新选择" />
		</form>
		<% else %>
        <p>
        <label>
			<%_ 升级包上传成功，确认升级？%>
        </label>
        </p>
		<ul>
			<li>
            <p>
            <%:大小%>: <%
            local w = require "luci.tools.webadmin"
            write(w.byte_format(size))
            %>
            </p>
            </li>
		</ul>
        <div>
		<form style="display:inline">
			<input type="hidden" name="step" value="3" />
			<input class="btn" type="submit" value="升级" />	
		</form>
		<form style="display:inline">
			<input type="hidden" name="step" value="1" />
			<input class="btn" type="submit" value="取消" />
		</form>
        </div>
		<% end %>
    </div>
<% elseif step == 3 then %>
<div class="memu row">
    <p><label>正在升级，请勿断电...</label></p>
		
	<!-- <iframe src="<%=REQUEST_URI%>?step=4" style="border:1px solid black; width:100%; height:150px"></iframe> -->
</div>
<% end %>
</div>
<%if step == 3 then %>
<script type="text/javascript">
$(function(){
    window.parent.upgrade_window();       
});
</script>
<%end%>
</body>
</html>
